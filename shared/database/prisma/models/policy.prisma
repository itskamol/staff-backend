model Policy {
  id                    Int       @id @default(autoincrement())
  organizationId        Int       @map("organization_id")
  title                 String
  description           String?
  isActiveWindowEnabled Boolean   @default(false) @map("active_window")
  isScreenshotEnabled   Boolean   @default(false) @map("screenshot")
  isVisitedSitesEnabled Boolean   @default(false) @map("visited_sites")
  isDefault             Boolean   @default(false) @map("is_default")
  screenshotInterval    Int       @default(5) @map("screenshot_interval")
  screenshotIsGrayscale Boolean   @default(false) @map("screenshot_is_grayscale")
  screenshotCaptureAll  Boolean   @default(false) @map("screenshot_capture_all")
  isActive              Boolean   @default(true) @map("is_active")
  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")
  deletedAt             DateTime? @map("deleted_at")

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  employees    Employee[]
  rules        PolicyRule[]

  @@unique([organizationId, title])
  @@map("policies")
}

model PolicyRule {
  id              Int       @id @default(autoincrement())
  policyId        Int       @map("policy_id")
  resourceGroupId Int       @map("resource_group_id")
  type            RuleType // USEFUL, UNUSEFUL
  deletedAt       DateTime? @map("deleted_at")

  policy        Policy        @relation(fields: [policyId], references: [id], onDelete: Cascade)
  resourceGroup ResourceGroup @relation(fields: [resourceGroupId], references: [id], onDelete: Cascade)

  @@unique([policyId, resourceGroupId, type])
  @@index([policyId])
  @@index([resourceGroupId])
  @@map("policy_rules")
}

model ResourceGroup {
  id             Int          @id @default(autoincrement())
  organizationId Int          @map("organization_id")
  name           String
  type           ResourceType // WEBSITE, APPLICATION
  isActive       Boolean      @default(true) @map("is_active")
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  deletedAt      DateTime?    @map("deleted_at")

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  resources   ResourcesOnGroups[]
  policyRules PolicyRule[]

  @@unique([organizationId, name, type])
  @@map("resource_groups")
}

model ResourcesOnGroups {
  resourceId Int       @map("resource_id")
  groupId    Int       @map("group_id")
  assignedAt DateTime  @default(now()) @map("assigned_at")
  deletedAt  DateTime? @map("deleted_at")

  resource Resource      @relation(fields: [resourceId], references: [id], onDelete: Cascade)
  group    ResourceGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@id([resourceId, groupId])
  @@map("resources_on_groups")
}

model Resource {
  id             Int          @id @default(autoincrement())
  organizationId Int          @map("organization_id")
  value          String
  type           ResourceType
  createdAt      DateTime     @default(now()) @map("created_at")
  deletedAt      DateTime?    @map("deleted_at")

  organization Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  groups       ResourcesOnGroups[]

  @@unique([organizationId, value, type])
  @@map("resources")
}
