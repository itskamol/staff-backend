model Employee {
  id                Int      @id @default(autoincrement())
  departmentId      Int      @map("department_id")
  organizationId    Int      @map("organization_id")
  policyId          Int      @map("policy_id")
  name              String
  address           String?
  phone             String?
  email             String?
  photo             String?
  additionalDetails String?  @map("additional_details")
  isActive          Boolean  @default(true) @map("is_active")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  employeePlanId    Int?

  department    Department     @relation(fields: [departmentId], references: [id])
  policy        Policy         @relation(fields: [policyId], references: [id])
  plan          EmployeePlan?  @relation(fields: [employeePlanId], references: [id])
  organization  Organization   @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  credentials   Credential[]
  computerUsers ComputerUser[]
  actions       Action[]
  employeeSyncs EmployeeSync[]
  attendances   Attendance[]
  employeeGates GateEmployee[]

  @@index([organizationId])
  @@index([organizationId, departmentId])
  @@index([organizationId, policyId])
  @@index([organizationId, isActive])
  @@index([email])
  @@map("employees")
}

model Credential {
  id                Int        @id @default(autoincrement())
  employeeId        Int        @map("employee_id")
  code              String
  type              ActionType
  additionalDetails String?    @map("additional_details")
  organizationId    Int?       @map("organization_id")

  // --- Standard Fields ---
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  employee     Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, code, type], name: "emp_credential_unique")
  @@index([employeeId])
  @@index([code])
  @@index([type])
  @@map("credentials")
}

model EmployeeSync {
  id             Int        @id @default(autoincrement())
  employeeId     Int
  deviceId       Int
  gateId         Int
  status         StatusEnum @default(WAITING)
  message        String?
  organizationId Int?       @map("organization_id")
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  gate         Gate          @relation(fields: [gateId], references: [id], onDelete: Cascade)
  device       Device        @relation(fields: [deviceId], references: [id], onDelete: Cascade)
  employee     Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

model EmployeePlan {
  id                   Int     @id @default(autoincrement())
  name                 String?
  addadditionalDetails String?
  startTime            String
  endTime              String
  extraTime            String
  weekdays             String
  isDefault            Boolean @default(false)
  isActive             Boolean @default(true)
  organizationId       Int?    @map("organization_id")

  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  employees    Employee[]
}
