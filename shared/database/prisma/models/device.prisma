model Action {
  id             Int           @id @default(autoincrement())
  deviceId       Int?          @map("device_id")
  gateId         Int?          @map("gate_id")
  actionTime     DateTime      @map("action_time")
  employeeId     Int?          @map("employee_id")
  visitorId      Int?          @map("visitor_id")
  organizationId Int?          @map("organization_id")
  actionResult   String?       @map("action_result")
  visitorType    VisitorType
  entryType      EntryType
  actionType     ActionType
  actionMode     ActionMode
  status         ActionStatus?
  deletedAt      DateTime?     @map("deleted_at")

  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  device       Device?       @relation(fields: [deviceId], references: [id], onDelete: SetNull)
  gate         Gate?         @relation(fields: [gateId], references: [id], onDelete: SetNull)
  employee     Employee?     @relation(fields: [employeeId], references: [id], onDelete: SetNull)
  visitor      Visitor?      @relation(fields: [visitorId], references: [id], onDelete: SetNull)

  @@index([deviceId])
  @@index([gateId])
  @@index([employeeId])
  @@index([visitorId])
  @@index([actionTime])
  @@index([actionTime, deviceId])
  @@index([actionTime, employeeId])
  @@index([visitorType])
  @@index([entryType])
  @@index([organizationId])
  @@map("actions")
}

model Gate {
  id        Int       @id @default(autoincrement())
  name      String
  isActive  Boolean   @default(true) @map("is_active")
  deletedAt DateTime? @map("deleted_at")
  createdAt DateTime  @default(now()) @map("created_at")

  organizations Organization[]
  devices       Device[]
  actions       Action[]
  employeeSyncs EmployeeSync[]
  employees     Employee[]

  @@index([name])
  @@map("gates")
}

model Device {
  id               Int           @id @default(autoincrement())
  gateId           Int?          @map("gate_id")
  name             String?
  entryType        EntryType?    @map("entry_type")
  type             DeviceType?   @map("type")
  manufacturer     String?
  model            String?
  firmware         String?
  serialNumber     String?       @map("serial_number")
  ipAddress        String?       @map("ip_address")
  login            String?
  password         String?
  capabilities     Json?
  welcomeText      String?       @map("welcome_text")
  welcomeTextType  WelcomeText?  @map("welcome_text_type")
  welcomePhoto     String?       @map("welcome_photo")
  welcomePhotoType WelcomePhoto? @map("welcome_photo_type")
  isActive         Boolean       @default(true) @map("is_active")
  createdAt        DateTime      @default(now()) @map("created_at")
  updatedAt        DateTime      @updatedAt @map("updated_at")
  deletedAt        DateTime?     @map("deleted_at")

  gate         Gate?          @relation(fields: [gateId], references: [id], onDelete: SetNull)
  actions      Action[]
  EmployeeSync EmployeeSync[]

  @@index([gateId])
  @@index([ipAddress])
  @@index([serialNumber])
  @@index([isActive])
  @@map("devices")
}

model Attendance {
  id             Int           @id @default(autoincrement())
  startTime      DateTime?     @map("start_time")
  endTime        DateTime?     @map("end_time")
  arrivalStatus  ActionStatus  @map("arrival_status") // ON_TIME or LATE
  goneStatus     ActionStatus? @map("gone_status") // ON_TIME or EARLY
  reason         String?
  reasonTypeId   Int?          @map("reason_id")
  employeeId     Int           @map("employee_id")
  organizationId Int?          @map("organization_id")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime?     @updatedAt @map("updated_at")
  deletedAt      DateTime?     @map("deleted_at")

  employee     Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  reasons      Reasons?      @relation(fields: [reasonTypeId], references: [id], onDelete: Cascade)

  @@index([startTime, endTime])
  @@index([employeeId])
  @@index([organizationId])
  @@map("attendances")
}

model Reasons {
  id             Int       @id @default(autoincrement())
  uz             String?
  eng            String?
  ru             String?
  organizationId Int       @map("organization_id")
  isActive       Boolean   @default(true) @map("is_active")
  createdAt      DateTime  @default(now()) @map("created_at")
  deletedAt      DateTime? @map("deleted_at")

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  attendances  Attendance[]
}
