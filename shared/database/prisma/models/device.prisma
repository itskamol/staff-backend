model Action {
  id             Int           @id @default(autoincrement())
  deviceId       Int?          @map("device_id")
  gateId         Int?          @map("gate_id")
  actionTime     DateTime      @map("action_time")
  employeeId     Int?          @map("employee_id")
  visitorId      Int?          @map("visitor_id")
  visitorType    VisitorType
  entryType      EntryType
  actionType     ActionType
  actionResult   String?       @map("action_result")
  actionMode     ActionMode
  status         ActionStatus?
  organizationId Int?          @map("organization_id")

  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  device       Device?       @relation(fields: [deviceId], references: [id], onDelete: SetNull)
  gate         Gate?         @relation(fields: [gateId], references: [id], onDelete: SetNull)
  employee     Employee?     @relation(fields: [employeeId], references: [id], onDelete: SetNull)
  visitor      Visitor?      @relation(fields: [visitorId], references: [id], onDelete: SetNull)

  @@index([deviceId])
  @@index([gateId])
  @@index([employeeId])
  @@index([visitorId])
  @@index([actionTime])
  @@index([actionTime, deviceId])
  @@index([actionTime, employeeId])
  @@index([visitorType])
  @@index([entryType])
  @@map("actions")
}

model Gate {
  id             Int      @id @default(autoincrement())
  name           String
  organizationId Int?     @map("organization_id")
  createdAt      DateTime @default(now()) @map("created_at")

  organization Organization?  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  devices      Device[]
  actions      Action[]
  EmployeeSync EmployeeSync[]

  @@index([name])
  @@map("gates")
}

model Device {
  id               Int           @id @default(autoincrement())
  gateId           Int?          @map("gate_id")
  name             String?
  entryType        EntryType?    @map("entry_type")
  type             DeviceType?   @map("type")
  manufacturer     String?
  model            String?
  firmware         String?
  serialNumber     String?       @map("serial_number")
  ipAddress        String?       @map("ip_address")
  login            String?
  password         String?
  capabilities     Json?
  welcomeText      String?       @map("welcome_text")
  welcomeTextType  WelcomeText?  @map("welcome_text_type")
  welcomePhoto     String?       @map("welcome_photo")
  welcomePhotoType WelcomePhoto? @map("welcome_photo_type")

  // --- Standard Fields ---
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  gate         Gate?          @relation(fields: [gateId], references: [id], onDelete: SetNull)
  actions      Action[]
  EmployeeSync EmployeeSync[]

  @@index([gateId])
  @@index([ipAddress])
  @@index([serialNumber])
  @@index([isActive])
  @@map("devices")
}

model Attendance {
  id             Int           @id @default(autoincrement())
  startTime      DateTime
  endTime        DateTime?
  arrivalStatus  ActionStatus // ON_TIME or LATE
  goneStatus     ActionStatus? // ON_TIME or EARLY
  reason         String?
  employeeId     Int
  organizationId Int

  employee    Employee     @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  organiztion Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
}
